{
  "id": "/Rule",
  "type": "object",
  "properties": {
    "uuid": {
      "type": "string", "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
      "custom": { "propertyName": "Rule.uuid" }
    },
    "ruleName": {
      "type": "string", "pattern": "^.{1,200}$",
      "custom": { "propertyName": "Rule.ruleName" }
    },
    "ruleRank": {
      "type": ["integer", "null"], "minimum": 1,
      "custom": { "propertyName": "Rule.ruleRank" }
    },
    "targetType": {
      "type": "string", "pattern": "^Transaction$",
      "custom": { "propertyName": "Rule.targetType" }
    },
    "status": {
      "type": "string", "pattern": "^active|inactive$",
      "custom": { "propertyName": "Rule.status" }
    },
    "ruleType": {
      "type": "string", "pattern": "^User|Accountant|Feedback|Global$",
      "custom": { "propertyName": "Rule.ruleType" }
    },
    "globalRuleID": {
      "type": ["string", "null" ], "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
      "custom": { "propertyName": "Rule.globalRuleId" }
    },
    "ruleCounts": {
      "type": "object",
      "custom": {
        "item": {
          "propertyName": "Rule.ruleCounts",
          "paramKey": "ruleCounts",
          "useParent": 2
        }
      },
      "properties": {
        "success": { "type": "integer", "minimum": 0 },
        "fail": { "type": "integer", "minimum": 0 },
        "applied": {"type": "integer", "minimum": 0 }
      },
      "required": ["success", "fail", "applied"]
    },
    "ruleConditions": {
      "type": "array",
      "custom": {
          "propertyName": "Rule.ruleConditions",
          "message": "should be an array",
          "items": {
            "stringify": true,
            "propertyName": "Rule.ruleConditions",
            "paramKey": "ruleConditions"
          }
      },
      "items": {
        "oneOf": [
          {
            "properties": {
              "ruleField": { "enum": ["transactionNarrative"] },
              "ruleOperation": { "type": "string", "pattern": "^containsWords|contains|notcontains|eq" },
              "ruleCriteria": { "type": "string", "pattern": "^.{1,200}$" }
            },
            "required": ["ruleField", "ruleOperation", "ruleCriteria"]
          },
          {
            "properties": {
              "ruleField": { "enum": ["transactionAmount"] },
              "ruleOperation": { "type": "string", "pattern": "eq|gt|lt|ge|le" },
              "ruleCriteria": { "type": "string", "pattern": "^.{1,200}$" }
            },
            "required": ["ruleField", "ruleOperation", "ruleCriteria"]
          },
          {
            "properties": {
              "ruleField": { "enum": ["datePosted"] },
              "ruleOperation": { "type": "string", "pattern": "gt|lt|ge|le" },
              "ruleCriteria": { "type": "string", "pattern": "^.{1,200}$" }
            },
            "required": ["ruleField", "ruleOperation", "ruleCriteria"]
          },
          {
            "properties": {
              "ruleField": { "enum": ["transactionType", "checkNum", "currency", "payee.payeeBankId", "payee.payeeAccountId", "$baseType"] },
              "ruleOperation": { "type": "string", "pattern": "eq" },
              "ruleCriteria": { "type": "string", "pattern": "^.{1,200}$" }
            },
            "required": ["ruleField", "ruleOperation", "ruleCriteria"]
          }
        ]
      }
    },
    "ruleActions": {
      "type": "array",
      "custom": {
        "propertyName": "Rule.ruleActions",
        "message": "should be an array",
        "items": {
          "propertyName": "Object.ruleActions",
          "useParent": 2,
          "paramKey": "ruleActions"
        }
      },
      "items": {
        "properties": {
          "splitAmount": { "type": "number", "minimum": 0 },
          "splitPercentage": { "type": "integer", "minimum": 0, "maximum": 100 },
          "accountantNarrative": { "type": ["string", "null"], "pattern": "^.{0,200}$" },
          "accountsPostings": {
            "type": "array",
            "items": {
              "properties": {
                "type": { "type": "string", "pattern": "^.{1,200}$" },
                "code": { "type": "string", "pattern": "^.{1,200}$" }
              },
              "required": ["type", "code"]
            }
          }
        },
        "required": ["accountsPostings"]
      }
    },
    "ruleAdditionalFields": {
      "type": "array",
      "custom": {
        "propertyName": "Rule.ruleAdditionalFields",
        "message": "should be an array",
        "items": {
          "propertyName": "Object.ruleAdditionalFields",
          "paramKey": "ruleAdditionalFields",
          "useParent": 2
        }
      },
      "items": {
        "properties": {
          "name": { "type": "string", "pattern": "^.{1,50}$" },
          "value": { "type": "string", "pattern": "^.{1,50}$" }
        },
        "required": ["name", "value"]
      }
    }
  },
  "required": ["ruleName", "targetType", "status", "ruleConditions", "ruleActions", "ruleAdditionalFields"]
}