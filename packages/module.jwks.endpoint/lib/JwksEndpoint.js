'use strict';

const crypto = require('crypto');
const JwksCache = require('./JwksCache');
const Promise = require('bluebird');var _require =
require('@sage/bc-request-logger');const RequestLogger = _require.RequestLogger;

const keyType = 'RSA';
const keyUse = 'sig';
const algorithm = 'RS256';
const DEFAULT_CACHE_TTL = 600;

class JwksEndpoint {
    constructor(config) {// TODO: rewrite me
        this.className = 'JwksEndpoint';
        this.logger = RequestLogger.Create({ service: 'JwksEndpoint' });
        const env = process.env.Environment;
        const cacheExpiry = config.cacheExpiry || DEFAULT_CACHE_TTL;

        this.paramPrefix = `/${env}/`;
        this.primaryKeyName = `${this.paramPrefix}accessToken.primary.publicKey`;
        this.secondaryKeyName = `${this.paramPrefix}accessToken.secondary.publicKey`;

        this.tokenCache = new JwksCache({ endpoint: 'TODO', cacheExpiry: cacheExpiry }, this.logger);
    }

    getJwks(...args) {
        return getJwksImpl(this, ...args);
    }}


const getJwksImpl = Promise.method((self, req, res) => {
    const func = `${self.className}.onGetJwksImpl`;
    self.logger.info({ function: func, msg: 'started' });

    return self.tokenCache.getParams().then(params => {
        return checkKeys(self, params);
    }).then(keys => {
        const response = makeResponse(self, keys);
        return res.send(200, response);
    }).catch(err => {
        //self.logger.error({ function: func, msg: 'Failed to get jwks.', err: err });
        return res.send(500, err);
    }).then(data => {
        //self.logger.info({ function: func, msg: 'ended' });
        return data;
    });
});

function checkKeys(self, params) {
    const func = 'checkKeys';
    const primary = params[self.primaryKeyName];
    const secondary = params[self.secondaryKeyName];

    if (!primary) {
        //self.logger.error({ function: func, msg: 'primary key not found', keyName: self.primaryKeyName });
        throw new Error('Failed to retrieve primary key');
    }
    if (!secondary) {
        //self.logger.error({ function: func, msg: 'secondary key not found', keyName: self.secondaryKeyName });
        throw new Error('Failed to retrieve secondary key');
    }
    return { primary, secondary };
}

function makeResponse(self, keys) {
    const primaryDer = convertPemToDer(keys.primary);
    const secondaryDer = convertPemToDer(keys.secondary);

    const primaryKeyId = getHash(primaryDer);
    const secondaryKeyId = getHash(secondaryDer);

    // "x5c" is the DER of the key, "kid" is a hash of this
    const response = {
        keys: [
        {
            kty: keyType,
            alg: algorithm,
            use: keyUse,
            kid: primaryKeyId,
            x5c: [primaryDer] },

        {
            kty: keyType,
            alg: algorithm,
            use: keyUse,
            kid: secondaryKeyId,
            x5c: [secondaryDer] }] };



    return response;
}

// TODO: refactor me -----------------------------------------------------------

function getHash(data, salt = 'DefaultSaltMustBeRewritten') {
    return crypto.createHash('sha256').update(data + salt).digest('hex');
}


function convertPemToDer(pem) {
    return pem.replace(/-----BEGIN RSA PUBLIC KEY-----/g, '').
    replace(/-----END RSA PUBLIC KEY-----/g, '').
    replace(/\\n/g, '').
    replace(/\\\\n/g, '').
    replace(/\s/g, '').
    trim();
}

// =============================================================================

module.exports = JwksEndpoint;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Kd2tzRW5kcG9pbnQuanMiXSwibmFtZXMiOlsiY3J5cHRvIiwicmVxdWlyZSIsIkp3a3NDYWNoZSIsIlByb21pc2UiLCJSZXF1ZXN0TG9nZ2VyIiwia2V5VHlwZSIsImtleVVzZSIsImFsZ29yaXRobSIsIkRFRkFVTFRfQ0FDSEVfVFRMIiwiSndrc0VuZHBvaW50IiwiY29uc3RydWN0b3IiLCJjb25maWciLCJjbGFzc05hbWUiLCJsb2dnZXIiLCJDcmVhdGUiLCJzZXJ2aWNlIiwiZW52IiwicHJvY2VzcyIsIkVudmlyb25tZW50IiwiY2FjaGVFeHBpcnkiLCJwYXJhbVByZWZpeCIsInByaW1hcnlLZXlOYW1lIiwic2Vjb25kYXJ5S2V5TmFtZSIsInRva2VuQ2FjaGUiLCJlbmRwb2ludCIsImdldEp3a3MiLCJhcmdzIiwiZ2V0Sndrc0ltcGwiLCJtZXRob2QiLCJzZWxmIiwicmVxIiwicmVzIiwiZnVuYyIsImluZm8iLCJmdW5jdGlvbiIsIm1zZyIsImdldFBhcmFtcyIsInRoZW4iLCJwYXJhbXMiLCJjaGVja0tleXMiLCJrZXlzIiwicmVzcG9uc2UiLCJtYWtlUmVzcG9uc2UiLCJzZW5kIiwiY2F0Y2giLCJlcnIiLCJkYXRhIiwicHJpbWFyeSIsInNlY29uZGFyeSIsIkVycm9yIiwicHJpbWFyeURlciIsImNvbnZlcnRQZW1Ub0RlciIsInNlY29uZGFyeURlciIsInByaW1hcnlLZXlJZCIsImdldEhhc2giLCJzZWNvbmRhcnlLZXlJZCIsImt0eSIsImFsZyIsInVzZSIsImtpZCIsIng1YyIsInNhbHQiLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwiZGlnZXN0IiwicGVtIiwicmVwbGFjZSIsInRyaW0iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxTQUFTQyxRQUFRLFFBQVIsQ0FBZjtBQUNBLE1BQU1DLFlBQVlELFFBQVEsYUFBUixDQUFsQjtBQUNBLE1BQU1FLFVBQVVGLFFBQVEsVUFBUixDQUFoQixD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O0FBQ0EsVUFBTUssaUJBQWlCRCxRQUFRRixZQUFSLENBQXZCOztBQUVBO0FBQ0EsVUFBTVgsV0FBVztBQUNiRCxjQUFNO0FBQ0Y7QUFDSWdCLGlCQUFLbkQsT0FEVDtBQUVJb0QsaUJBQUtsRCxTQUZUO0FBR0ltRCxpQkFBS3BELE1BSFQ7QUFJSXFELGlCQUFLTixZQUpUO0FBS0lPLGlCQUFLLENBQUNWLFVBQUQsQ0FMVCxFQURFOztBQVFGO0FBQ0lNLGlCQUFLbkQsT0FEVDtBQUVJb0QsaUJBQUtsRCxTQUZUO0FBR0ltRCxpQkFBS3BELE1BSFQ7QUFJSXFELGlCQUFLSixjQUpUO0FBS0lLLGlCQUFLLENBQUNSLFlBQUQsQ0FMVCxFQVJFLENBRE8sRUFBakI7Ozs7QUFrQkEsV0FBT1gsUUFBUDtBQUNIOztBQUVEOztBQUVBLFNBQVNhLE9BQVQsQ0FBaUJSLElBQWpCLEVBQXVCZSxPQUFPLDRCQUE5QixFQUE0RDtBQUN4RCxXQUFPN0QsT0FBTzhELFVBQVAsQ0FBa0IsUUFBbEIsRUFBNEJDLE1BQTVCLENBQW1DakIsT0FBT2UsSUFBMUMsRUFBZ0RHLE1BQWhELENBQXVELEtBQXZELENBQVA7QUFDSDs7O0FBR0QsU0FBU2IsZUFBVCxDQUF5QmMsR0FBekIsRUFBOEI7QUFDMUIsV0FBT0EsSUFBSUMsT0FBSixDQUFZLGlDQUFaLEVBQStDLEVBQS9DO0FBQ0ZBLFdBREUsQ0FDTSwrQkFETixFQUN1QyxFQUR2QztBQUVGQSxXQUZFLENBRU0sTUFGTixFQUVjLEVBRmQ7QUFHRkEsV0FIRSxDQUdNLFFBSE4sRUFHZ0IsRUFIaEI7QUFJRkEsV0FKRSxDQUlNLEtBSk4sRUFJYSxFQUpiO0FBS0ZDLFFBTEUsRUFBUDtBQU1IOztBQUVEOztBQUVBQyxPQUFPQyxPQUFQLEdBQWlCNUQsWUFBakIiLCJmaWxlIjoiSndrc0VuZHBvaW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IEp3a3NDYWNoZSA9IHJlcXVpcmUoJy4vSndrc0NhY2hlJyk7XG5jb25zdCBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbmNvbnN0IHtSZXF1ZXN0TG9nZ2VyfSA9IHJlcXVpcmUoJ0BzYWdlL2JjLXJlcXVlc3QtbG9nZ2VyJyk7XG5cbmNvbnN0IGtleVR5cGUgPSAnUlNBJztcbmNvbnN0IGtleVVzZSA9ICdzaWcnO1xuY29uc3QgYWxnb3JpdGhtID0gJ1JTMjU2JztcbmNvbnN0IERFRkFVTFRfQ0FDSEVfVFRMID0gNjAwO1xuXG5jbGFzcyBKd2tzRW5kcG9pbnQge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykgeyAvLyBUT0RPOiByZXdyaXRlIG1lXG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ0p3a3NFbmRwb2ludCc7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gUmVxdWVzdExvZ2dlci5DcmVhdGUoeyBzZXJ2aWNlOiAnSndrc0VuZHBvaW50JyB9KTtcbiAgICAgICAgY29uc3QgZW52ID0gcHJvY2Vzcy5lbnYuRW52aXJvbm1lbnQ7XG4gICAgICAgIGNvbnN0IGNhY2hlRXhwaXJ5ID0gY29uZmlnLmNhY2hlRXhwaXJ5IHx8IERFRkFVTFRfQ0FDSEVfVFRMO1xuXG4gICAgICAgIHRoaXMucGFyYW1QcmVmaXggPSBgLyR7ZW52fS9gO1xuICAgICAgICB0aGlzLnByaW1hcnlLZXlOYW1lID0gYCR7dGhpcy5wYXJhbVByZWZpeH1hY2Nlc3NUb2tlbi5wcmltYXJ5LnB1YmxpY0tleWA7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5S2V5TmFtZSA9IGAke3RoaXMucGFyYW1QcmVmaXh9YWNjZXNzVG9rZW4uc2Vjb25kYXJ5LnB1YmxpY0tleWA7XG5cbiAgICAgICAgdGhpcy50b2tlbkNhY2hlID0gbmV3IEp3a3NDYWNoZSh7IGVuZHBvaW50OiAnVE9ETycsIGNhY2hlRXhwaXJ5OiBjYWNoZUV4cGlyeSB9LCB0aGlzLmxvZ2dlcik7XG4gICAgfVxuXG4gICAgZ2V0SndrcyguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBnZXRKd2tzSW1wbCh0aGlzLCAuLi5hcmdzKTtcbiAgICB9XG59XG5cbmNvbnN0IGdldEp3a3NJbXBsID0gUHJvbWlzZS5tZXRob2QoKHNlbGYsIHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgZnVuYyA9IGAke3NlbGYuY2xhc3NOYW1lfS5vbkdldEp3a3NJbXBsYDtcbiAgICBzZWxmLmxvZ2dlci5pbmZvKHsgZnVuY3Rpb246IGZ1bmMsIG1zZzogJ3N0YXJ0ZWQnIH0pO1xuXG4gICAgcmV0dXJuIHNlbGYudG9rZW5DYWNoZS5nZXRQYXJhbXMoKS50aGVuKHBhcmFtcyA9PiB7XG4gICAgICAgIHJldHVybiBjaGVja0tleXMoc2VsZiwgcGFyYW1zKTtcbiAgICB9KS50aGVuKGtleXMgPT4ge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IG1ha2VSZXNwb25zZShzZWxmLCBrZXlzKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zZW5kKDIwMCwgcmVzcG9uc2UpO1xuICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIC8vc2VsZi5sb2dnZXIuZXJyb3IoeyBmdW5jdGlvbjogZnVuYywgbXNnOiAnRmFpbGVkIHRvIGdldCBqd2tzLicsIGVycjogZXJyIH0pO1xuICAgICAgICByZXR1cm4gcmVzLnNlbmQoNTAwLCBlcnIpO1xuICAgIH0pLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgLy9zZWxmLmxvZ2dlci5pbmZvKHsgZnVuY3Rpb246IGZ1bmMsIG1zZzogJ2VuZGVkJyB9KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSk7XG59KTtcblxuZnVuY3Rpb24gY2hlY2tLZXlzKHNlbGYsIHBhcmFtcykge1xuICAgIGNvbnN0IGZ1bmMgPSAnY2hlY2tLZXlzJztcbiAgICBjb25zdCBwcmltYXJ5ID0gcGFyYW1zW3NlbGYucHJpbWFyeUtleU5hbWVdO1xuICAgIGNvbnN0IHNlY29uZGFyeSA9IHBhcmFtc1tzZWxmLnNlY29uZGFyeUtleU5hbWVdO1xuXG4gICAgaWYgKCFwcmltYXJ5KSB7XG4gICAgICAgIC8vc2VsZi5sb2dnZXIuZXJyb3IoeyBmdW5jdGlvbjogZnVuYywgbXNnOiAncHJpbWFyeSBrZXkgbm90IGZvdW5kJywga2V5TmFtZTogc2VsZi5wcmltYXJ5S2V5TmFtZSB9KTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgcHJpbWFyeSBrZXknKTtcbiAgICB9XG4gICAgaWYgKCFzZWNvbmRhcnkpIHtcbiAgICAgICAgLy9zZWxmLmxvZ2dlci5lcnJvcih7IGZ1bmN0aW9uOiBmdW5jLCBtc2c6ICdzZWNvbmRhcnkga2V5IG5vdCBmb3VuZCcsIGtleU5hbWU6IHNlbGYuc2Vjb25kYXJ5S2V5TmFtZSB9KTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgc2Vjb25kYXJ5IGtleScpO1xuICAgIH1cbiAgICByZXR1cm4geyBwcmltYXJ5LCBzZWNvbmRhcnkgfTtcbn1cblxuZnVuY3Rpb24gbWFrZVJlc3BvbnNlKHNlbGYsIGtleXMpIHtcbiAgICBjb25zdCBwcmltYXJ5RGVyID0gY29udmVydFBlbVRvRGVyKGtleXMucHJpbWFyeSk7XG4gICAgY29uc3Qgc2Vjb25kYXJ5RGVyID0gY29udmVydFBlbVRvRGVyKGtleXMuc2Vjb25kYXJ5KTtcblxuICAgIGNvbnN0IHByaW1hcnlLZXlJZCA9IGdldEhhc2gocHJpbWFyeURlcik7XG4gICAgY29uc3Qgc2Vjb25kYXJ5S2V5SWQgPSBnZXRIYXNoKHNlY29uZGFyeURlcik7XG5cbiAgICAvLyBcIng1Y1wiIGlzIHRoZSBERVIgb2YgdGhlIGtleSwgXCJraWRcIiBpcyBhIGhhc2ggb2YgdGhpc1xuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgICBrZXlzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga3R5OiBrZXlUeXBlLFxuICAgICAgICAgICAgICAgIGFsZzogYWxnb3JpdGhtLFxuICAgICAgICAgICAgICAgIHVzZToga2V5VXNlLFxuICAgICAgICAgICAgICAgIGtpZDogcHJpbWFyeUtleUlkLFxuICAgICAgICAgICAgICAgIHg1YzogW3ByaW1hcnlEZXJdIH0sXG5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrdHk6IGtleVR5cGUsXG4gICAgICAgICAgICAgICAgYWxnOiBhbGdvcml0aG0sXG4gICAgICAgICAgICAgICAgdXNlOiBrZXlVc2UsXG4gICAgICAgICAgICAgICAga2lkOiBzZWNvbmRhcnlLZXlJZCxcbiAgICAgICAgICAgICAgICB4NWM6IFtzZWNvbmRhcnlEZXJdIH1dIH07XG5cblxuXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vLyBUT0RPOiByZWZhY3RvciBtZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5mdW5jdGlvbiBnZXRIYXNoKGRhdGEsIHNhbHQgPSAnRGVmYXVsdFNhbHRNdXN0QmVSZXdyaXR0ZW4nKSB7XG4gICAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUoZGF0YSArIHNhbHQpLmRpZ2VzdCgnaGV4Jyk7XG59XG5cblxuZnVuY3Rpb24gY29udmVydFBlbVRvRGVyKHBlbSkge1xuICAgIHJldHVybiBwZW0ucmVwbGFjZSgvLS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tL2csICcnKVxuICAgICAgICAucmVwbGFjZSgvLS0tLS1FTkQgUlNBIFBVQkxJQyBLRVktLS0tLS9nLCAnJylcbiAgICAgICAgLnJlcGxhY2UoL1xcXFxuL2csICcnKVxuICAgICAgICAucmVwbGFjZSgvXFxcXFxcXFxuL2csICcnKVxuICAgICAgICAucmVwbGFjZSgvXFxzL2csICcnKVxuICAgICAgICAudHJpbSgpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5tb2R1bGUuZXhwb3J0cyA9IEp3a3NFbmRwb2ludDsiXX0=